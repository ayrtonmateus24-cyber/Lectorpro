<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lector Pro - Arquitetura de Leitura</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap');
        
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #E2E2E2; border-radius: 10px; }
        
        .timer-text { font-variant-numeric: tabular-nums; }
        
        @keyframes bounce-subtle {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        .animate-bounce-subtle { animation: bounce-subtle 2s infinite ease-in-out; }

        @keyframes success-pulse {
            0% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(249, 115, 22, 0); }
            100% { box-shadow: 0 0 0 0 rgba(249, 115, 22, 0); }
        }
        .pulse-orange { animation: success-pulse 1s ease-out; }
        .pulse-green { animation: success-pulse 1s ease-out; box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); }

        .toast-enter { transform: translateX(100%); opacity: 0; }
        .toast-active { transform: translateX(0); opacity: 1; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }

        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        
        .mode-tab-active { @apply bg-white text-stone-900 shadow-sm; }
    </style>
</head>
<body class="bg-[#FDFCF8] text-[#2C3E50] selection:bg-orange-100 overflow-x-hidden">

    <!-- Container de Toasts -->
    <div id="toast-container" class="fixed bottom-8 right-8 z-[100] flex flex-col gap-3"></div>

    <!-- Header / Barra de Progresso Superior -->
    <nav class="fixed top-0 w-full bg-white/80 backdrop-blur-md border-b border-stone-200 z-50">
        <div class="max-w-5xl mx-auto h-1.5 w-full bg-stone-100 overflow-hidden">
            <div id="progress-bar" class="h-full bg-gradient-to-r from-orange-400 to-orange-600 transition-all duration-1000 ease-out w-0 shadow-[0_0_10px_rgba(249,115,22,0.5)]"></div>
        </div>
        <div class="max-w-5xl mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2 group cursor-default">
                <div id="header-logo-bg" class="w-8 h-8 bg-orange-500 rounded-lg flex items-center justify-center text-white shadow-lg transition-transform group-hover:rotate-12">
                    <i data-lucide="book-open" class="w-5 h-5"></i>
                </div>
                <span class="font-bold tracking-tight text-sm text-stone-800 uppercase">Lector <span id="header-pro-tag" class="text-orange-500">Pro</span></span>
            </div>
            <div class="flex items-center gap-4">
                <div class="hidden lg:block text-right">
                    <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest leading-none">Progresso</p>
                    <p id="progress-text" class="text-xs font-bold text-stone-600">0% concluído</p>
                </div>
                
                <div id="milestone-indicator" class="hidden md:flex items-center gap-2 bg-green-50 px-3 py-1 rounded-full border border-green-100 animate-bounce-subtle">
                    <i data-lucide="sparkles" class="w-3 h-3 text-green-600"></i>
                    <span class="text-[10px] font-bold text-green-700 uppercase tracking-tight">Ritmo Incrível!</span>
                </div>
                <div id="header-page-badge" class="text-sm font-bold text-orange-600 bg-orange-50 px-3 py-1 rounded-full border border-orange-100 shadow-sm">
                    Pág. <span id="current-page-display">0</span> / <span id="total-pages-display">100</span>
                </div>
            </div>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-6 pt-32 pb-20 grid grid-cols-1 lg:grid-cols-12 gap-12">
        
        <!-- Coluna Esquerda -->
        <section class="lg:col-span-7 space-y-8">
            <div id="timer-card" class="bg-white rounded-[2.5rem] p-8 md:p-10 border border-stone-200 shadow-xl shadow-stone-200/50 text-center space-y-8 relative overflow-hidden transition-all duration-500">
                
                <!-- Seletor de Modos (Tabs) -->
                <div class="flex p-1.5 bg-stone-100 rounded-2xl max-w-sm mx-auto relative z-10">
                    <button onclick="changeMode('focus')" id="tab-focus" class="flex-1 py-2 text-xs font-bold rounded-xl transition-all mode-tab-active">Foco</button>
                    <button onclick="changeMode('short')" id="tab-short" class="flex-1 py-2 text-xs font-bold rounded-xl transition-all text-stone-500 hover:text-stone-700">Curto</button>
                    <button onclick="changeMode('long')" id="tab-long" class="flex-1 py-2 text-xs font-bold rounded-xl transition-all text-stone-500 hover:text-stone-700">Longo</button>
                </div>

                <header>
                    <div id="timer-display" class="timer-text text-[90px] md:text-[120px] font-extralight leading-none tracking-tighter text-stone-900 mb-6 drop-shadow-sm">
                        25:00
                    </div>
                    
                    <div id="session-delta-badge" class="invisible inline-flex items-center gap-2 px-4 py-2 bg-green-50 text-green-700 rounded-full border border-green-100 text-sm font-bold shadow-sm transition-all scale-90">
                        <i data-lucide="award" class="w-4 h-4"></i>
                        <span id="delta-text">+0 páginas lidas agora</span>
                    </div>
                </header>

                <div class="flex justify-center gap-6 relative z-10">
                    <button id="btn-toggle" class="group flex items-center gap-3 px-10 py-5 rounded-2xl font-black text-lg bg-orange-500 text-white hover:bg-orange-600 shadow-xl shadow-orange-200 transition-all active:scale-95 focus:ring-4 focus:ring-orange-100 outline-none">
                        <i id="toggle-icon" data-lucide="play" class="w-6 h-6 fill-current"></i>
                        <span id="toggle-label">FOCO TOTAL</span>
                    </button>
                    <button id="btn-reset" class="p-5 rounded-2xl border-2 border-stone-100 text-stone-300 hover:text-stone-600 hover:border-stone-200 hover:bg-stone-50 transition-all active:scale-90 focus:ring-4 focus:ring-stone-100 outline-none">
                        <i data-lucide="rotate-ccw" class="w-6 h-6"></i>
                    </button>
                </div>

                <div class="pt-8 border-t border-stone-100 grid grid-cols-3 items-center">
                    <div class="space-y-1">
                        <p id="stat-sessions" class="text-2xl font-bold text-stone-800">0</p>
                        <p class="text-[10px] font-bold text-stone-400 uppercase tracking-widest">Sessões</p>
                    </div>
                    <div class="flex justify-center">
                        <div class="w-px h-10 bg-stone-100"></div>
                    </div>
                    <div id="stat-pages-container" class="space-y-1 text-orange-500 transition-all duration-300">
                        <p id="stat-pages" class="text-2xl font-bold">0</p>
                        <p class="text-[10px] font-bold uppercase tracking-widest">Páginas Agora</p>
                    </div>
                </div>
            </div>

            <!-- Configurações de Tempo e Meta -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Ajuste de Tempos -->
                <div class="bg-white rounded-3xl p-6 border border-stone-200 space-y-4 shadow-sm">
                    <h3 class="font-bold text-stone-800 text-xs uppercase tracking-widest flex items-center gap-2">
                        <i data-lucide="settings-2" class="w-4 h-4"></i> Ajustar Tempos (min)
                    </h3>
                    <div class="grid grid-cols-3 gap-3">
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-stone-400 uppercase block ml-1">Foco</label>
                            <input type="number" id="config-focus" value="25" class="w-full px-3 py-2 bg-stone-50 rounded-xl border border-stone-100 text-center font-bold text-sm focus:border-orange-200 outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-stone-400 uppercase block ml-1">Curto</label>
                            <input type="number" id="config-short" value="5" class="w-full px-3 py-2 bg-stone-50 rounded-xl border border-stone-100 text-center font-bold text-sm focus:border-green-200 outline-none">
                        </div>
                        <div class="space-y-1">
                            <label class="text-[9px] font-bold text-stone-400 uppercase block ml-1">Longo</label>
                            <input type="number" id="config-long" value="15" class="w-full px-3 py-2 bg-stone-50 rounded-xl border border-stone-100 text-center font-bold text-sm focus:border-blue-200 outline-none">
                        </div>
                    </div>
                </div>

                <!-- Atualizar Progresso -->
                <div id="meta-card" class="bg-white rounded-3xl p-6 border border-stone-200 flex items-center justify-between gap-4 shadow-sm">
                    <div class="space-y-1">
                        <h3 class="font-bold text-stone-800 text-xs uppercase tracking-widest">Página Atual</h3>
                        <div class="flex items-center gap-2">
                             <input type="number" id="input-current" min="0" value="0" class="w-16 p-2 bg-stone-50 rounded-lg border border-stone-100 font-bold text-center outline-none focus:border-orange-200">
                             <span class="text-stone-300">/</span>
                             <input type="number" id="input-total" min="1" value="100" class="w-16 p-2 bg-stone-50 rounded-lg border border-stone-100 font-bold text-center outline-none">
                        </div>
                    </div>
                    <div class="w-10 h-10 bg-stone-50 rounded-xl flex items-center justify-center text-stone-400">
                        <i data-lucide="book-open-check" class="w-5 h-5"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- Coluna Direita -->
        <section class="lg:col-span-5 space-y-6">
            <div class="sticky top-28 space-y-6">
                <div id="insight-card" class="bg-white rounded-[2rem] border border-stone-200 shadow-sm overflow-hidden flex flex-col transition-all">
                    <div class="p-6 border-b border-stone-100 bg-stone-50/50 flex items-center justify-between shrink-0">
                        <h3 class="font-bold flex items-center gap-2 text-stone-700">
                            <i data-lucide="bookmark" class="w-4 h-4 text-orange-500"></i>
                            Insight Log
                        </h3>
                        <span id="note-count" class="text-[10px] font-black text-white bg-stone-800 px-2.5 py-1 rounded-full shadow-md transition-transform duration-300">0</span>
                    </div>
                    
                    <div class="p-6">
                        <div class="relative mb-8">
                            <textarea id="note-input" placeholder="Que pensamento brilhante tiveste?" class="w-full p-5 rounded-[1.5rem] bg-stone-50 border-2 border-transparent focus:border-orange-200 focus:bg-white outline-none transition-all text-sm min-h-[120px] resize-none leading-relaxed custom-scrollbar"></textarea>
                            <button id="btn-add-note" class="absolute bottom-4 right-4 p-3 bg-stone-900 text-white rounded-xl hover:bg-orange-500 transition-all shadow-lg active:scale-90 focus:ring-4 focus:ring-orange-100">
                                <i data-lucide="send" class="w-5 h-5"></i>
                            </button>
                        </div>

                        <div id="notes-container" class="space-y-4 max-h-[340px] overflow-y-auto pr-2 custom-scrollbar">
                            <div class="text-center py-12 text-stone-300">
                                <i data-lucide="edit-3" class="w-8 h-8 mx-auto mb-3 opacity-10"></i>
                                <p class="text-xs font-medium italic">Seus insights aparecerão aqui.</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="p-5 bg-gradient-to-br from-stone-900 to-stone-800 rounded-[1.5rem] text-white flex gap-4 items-center shadow-2xl relative overflow-hidden group">
                    <div class="absolute inset-0 bg-orange-500/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    <div class="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center shrink-0 border border-white/5">
                        <i data-lucide="zap" class="w-5 h-5 text-orange-400"></i>
                    </div>
                    <p class="text-[11px] leading-snug text-stone-300 font-medium relative">
                        DICA: O ciclo de descanso longo ajuda a evitar o <span class="text-orange-400 font-bold">Burnout Mental</span>.
                    </p>
                </div>
            </div>
        </section>
    </main>

    <script>
        const state = {
            mode: 'focus', // 'focus', 'short', 'long'
            durations: {
                focus: 25,
                short: 5,
                long: 15
            },
            timeLeft: 25 * 60,
            isActive: false,
            sessionCount: 0,
            currentPage: 0,
            totalPages: 100,
            startPage: 0,
            notes: [],
            milestones: {
                firstPage: false,
                firstInsight: false,
                fivePages: false
            }
        };

        let timerInterval = null;

        const dom = {
            timer: document.getElementById('timer-display'),
            btnToggle: document.getElementById('btn-toggle'),
            toggleIcon: document.getElementById('toggle-icon'),
            toggleLabel: document.getElementById('toggle-label'),
            btnReset: document.getElementById('btn-reset'),
            inputCurrent: document.getElementById('input-current'),
            inputTotal: document.getElementById('input-total'),
            progressBar: document.getElementById('progress-bar'),
            progressText: document.getElementById('progress-text'),
            curPageDisp: document.getElementById('current-page-display'),
            totPageDisp: document.getElementById('total-pages-display'),
            statSessions: document.getElementById('stat-sessions'),
            statPages: document.getElementById('stat-pages'),
            statPagesContainer: document.getElementById('stat-pages-container'),
            deltaBadge: document.getElementById('session-delta-badge'),
            deltaText: document.getElementById('delta-text'),
            noteInput: document.getElementById('note-input'),
            btnAddNote: document.getElementById('btn-add-note'),
            notesContainer: document.getElementById('notes-container'),
            noteCount: document.getElementById('note-count'),
            toastContainer: document.getElementById('toast-container'),
            milestoneIndicator: document.getElementById('milestone-indicator'),
            timerCard: document.getElementById('timer-card'),
            // Config inputs
            configFocus: document.getElementById('config-focus'),
            configShort: document.getElementById('config-short'),
            configLong: document.getElementById('config-long'),
            // UI Header colors
            headerProTag: document.getElementById('header-pro-tag'),
            headerLogoBg: document.getElementById('header-logo-bg'),
            headerPageBadge: document.getElementById('header-page-badge')
        };

        function triggerConfetti(type = 'basic') {
            if (typeof confetti !== 'function') return;
            const colors = state.mode === 'focus' ? ['#f97316', '#22c55e', '#ffffff'] : ['#22c55e', '#3b82f6', '#ffffff'];
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors });
        }

        function showToast(title, message, icon = 'award') {
            const toast = document.createElement('div');
            toast.className = 'toast-enter flex items-center gap-4 bg-white border border-stone-200 p-4 rounded-2xl shadow-2xl min-w-[300px] pointer-events-auto';
            const colorClass = state.mode === 'focus' ? 'bg-orange-100 text-orange-600' : 'bg-green-100 text-green-600';
            toast.innerHTML = `
                <div class="w-10 h-10 ${colorClass} rounded-xl flex items-center justify-center shrink-0">
                    <i data-lucide="${icon}" class="w-6 h-6"></i>
                </div>
                <div>
                    <h4 class="font-bold text-stone-800 text-sm">${title}</h4>
                    <p class="text-xs text-stone-500">${message}</p>
                </div>
            `;
            dom.toastContainer.appendChild(toast);
            lucide.createIcons();
            setTimeout(() => toast.classList.add('toast-active'), 100);
            setTimeout(() => {
                toast.classList.remove('toast-active');
                setTimeout(() => toast.remove(), 400);
            }, 5000);
        }

        function changeMode(newMode) {
            state.isActive = false;
            clearInterval(timerInterval);
            state.mode = newMode;
            state.timeLeft = state.durations[newMode] * 60;
            
            // UI Updates for Tabs
            ['focus', 'short', 'long'].forEach(m => {
                const tab = document.getElementById(`tab-${m}`);
                tab.className = `flex-1 py-2 text-xs font-bold rounded-xl transition-all ${m === newMode ? 'mode-tab-active' : 'text-stone-500 hover:text-stone-700'}`;
            });

            // UI Theme colors
            const colors = {
                focus: { main: 'bg-orange-500', hover: 'hover:bg-orange-600', ring: 'focus:ring-orange-100', text: 'text-orange-500', bar: 'from-orange-400 to-orange-600' },
                short: { main: 'bg-green-500', hover: 'hover:bg-green-600', ring: 'focus:ring-green-100', text: 'text-green-500', bar: 'from-green-400 to-green-600' },
                long: { main: 'bg-blue-500', hover: 'hover:bg-blue-600', ring: 'focus:ring-blue-100', text: 'text-blue-500', bar: 'from-blue-400 to-blue-600' }
            };

            const c = colors[newMode];
            dom.btnToggle.className = `group flex items-center gap-3 px-10 py-5 rounded-2xl font-black text-lg ${c.main} ${c.hover} text-white shadow-xl shadow-stone-200 transition-all active:scale-95 ${c.ring} outline-none`;
            dom.progressBar.className = `h-full bg-gradient-to-r ${c.bar} transition-all duration-1000 ease-out w-0`;
            dom.toggleLabel.innerText = newMode === 'focus' ? 'FOCO TOTAL' : 'RELAXAR';
            dom.toggleIcon.setAttribute('data-lucide', 'play');

            updateTimerDisplay();
            updateContentUI();
            lucide.createIcons();
        }

        function updateTimerDisplay() {
            const mins = Math.floor(state.timeLeft / 60);
            const secs = state.timeLeft % 60;
            if(dom.timer) dom.timer.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        function updateContentUI(isNewPage = false) {
            if (state.currentPage > state.totalPages) state.currentPage = state.totalPages;
            
            const percentage = Math.min(Math.round((state.currentPage / state.totalPages) * 100), 100);
            
            if(dom.progressBar) dom.progressBar.style.width = `${percentage}%`;
            if(dom.progressText) dom.progressText.innerText = `${percentage}% concluído`;
            if(dom.curPageDisp) dom.curPageDisp.innerText = state.currentPage;
            if(dom.totPageDisp) dom.totPageDisp.innerText = state.totalPages;
            if(dom.statSessions) dom.statSessions.innerText = state.sessionCount;
            
            const delta = state.mode === 'focus' ? Math.max(state.currentPage - state.startPage, 0) : 0;
            if(dom.statPages) dom.statPages.innerText = delta;

            if (delta > 0 && state.mode === 'focus') {
                if(dom.deltaBadge) dom.deltaBadge.classList.remove('invisible', 'opacity-0', 'scale-90');
                if(dom.deltaBadge) dom.deltaBadge.classList.add('visible', 'opacity-100', 'scale-100');
                if(dom.deltaText) dom.deltaText.innerText = `+${delta} ${delta === 1 ? 'página lida' : 'páginas lidas'} agora`;
            } else {
                if(dom.deltaBadge) dom.deltaBadge.classList.add('invisible', 'opacity-0', 'scale-90');
            }

            if (isNewPage && dom.statPagesContainer) {
                dom.statPagesContainer.classList.add('scale-110');
                setTimeout(() => dom.statPagesContainer.classList.remove('scale-110'), 300);
            }

            if(dom.noteCount) dom.noteCount.innerText = state.notes.length;
            renderNotes();
        }

        function renderNotes() {
            if (!dom.notesContainer) return;
            if (state.notes.length === 0) {
                dom.notesContainer.innerHTML = `<div class="text-center py-12 text-stone-300 italic text-xs">Insights aparecerão aqui.</div>`;
            } else {
                dom.notesContainer.innerHTML = state.notes.map(note => `
                    <div class="note-animation bg-stone-50 border border-stone-100 p-4 rounded-2xl relative mb-3">
                        <div class="flex justify-between items-center mb-1">
                            <span class="text-[9px] font-black text-orange-500 uppercase">Pág. ${note.page}</span>
                            <span class="text-[9px] text-stone-400 font-medium">${note.time}</span>
                        </div>
                        <p class="text-sm text-stone-700 leading-tight">"${note.text}"</p>
                    </div>
                `).join('');
            }
        }

        function handleTimerComplete() {
            state.isActive = false;
            clearInterval(timerInterval);
            
            if (state.mode === 'focus') {
                state.sessionCount++;
                triggerConfetti();
                showToast("Foco Concluído!", "Hora de um pequeno descanso.", "coffee");
                // Sugere descanso curto ou longo
                const nextMode = state.sessionCount % 4 === 0 ? 'long' : 'short';
                setTimeout(() => changeMode(nextMode), 2000);
            } else {
                showToast("Descanso Terminado", "Pronto para voltar ao livro?", "book-open");
                setTimeout(() => changeMode('focus'), 2000);
            }
            
            updateContentUI();
        }

        // --- Eventos ---
        dom.btnToggle.addEventListener('click', () => {
            if (!state.isActive) {
                state.isActive = true;
                if(state.mode === 'focus') state.startPage = state.currentPage;
                dom.btnToggle.classList.add('opacity-80');
                dom.toggleLabel.innerText = 'PAUSAR';
                dom.toggleIcon.setAttribute('data-lucide', 'pause');
                
                timerInterval = setInterval(() => {
                    if (state.timeLeft > 0) {
                        state.timeLeft--;
                        updateTimerDisplay();
                    } else {
                        handleTimerComplete();
                    }
                }, 1000);
            } else {
                state.isActive = false;
                clearInterval(timerInterval);
                dom.btnToggle.classList.remove('opacity-80');
                dom.toggleLabel.innerText = 'CONTINUAR';
                dom.toggleIcon.setAttribute('data-lucide', 'play');
            }
            lucide.createIcons();
        });

        dom.btnReset.addEventListener('click', () => {
            state.isActive = false;
            clearInterval(timerInterval);
            state.timeLeft = state.durations[state.mode] * 60;
            updateTimerDisplay();
            updateContentUI();
            lucide.createIcons();
        });

        // Config Inputs logic
        [dom.configFocus, dom.configShort, dom.configLong].forEach(input => {
            input.addEventListener('change', (e) => {
                const mode = e.target.id.split('-')[1];
                state.durations[mode] = parseInt(e.target.value) || 1;
                if(state.mode === mode && !state.isActive) {
                    state.timeLeft = state.durations[mode] * 60;
                    updateTimerDisplay();
                }
            });
        });

        dom.inputCurrent.addEventListener('change', (e) => {
            state.currentPage = parseInt(e.target.value) || 0;
            updateContentUI(true);
        });

        dom.inputTotal.addEventListener('change', (e) => {
            state.totalPages = parseInt(e.target.value) || 1;
            updateContentUI();
        });

        dom.btnAddNote.addEventListener('click', () => {
            const text = dom.noteInput.value.trim();
            if (!text) return;
            state.notes.unshift({
                id: Date.now(),
                text: text,
                page: state.currentPage,
                time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
            });
            dom.noteInput.value = '';
            updateContentUI();
        });

        lucide.createIcons();
        updateTimerDisplay();
        updateContentUI();
    </script>
</body>
</html>
